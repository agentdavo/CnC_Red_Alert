cmake_minimum_required(VERSION 3.13)
project(redalert C)

set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)
add_compile_options(-Wall -Wextra -Werror)

option(ENABLE_ASM "Enable assembly modules" ON)
set(REPLACEMENT_ASM_DIR "" CACHE PATH "Directory with replacement assembly code")

set(SOURCES
        CODE/2KEYFRAM.CPP
        CODE/AADATA.CPP
        CODE/ABSTRACT.CPP
        CODE/ADATA.CPP
        CODE/ADPCM.CPP
        CODE/AIRCRAFT.CPP
        CODE/ALLOC.CPP
        CODE/ANIM.CPP
        CODE/AUDIO.CPP
        CODE/B64PIPE.CPP
        CODE/B64STRAW.CPP
        CODE/BAR.CPP
        CODE/BASE.CPP
        CODE/BASE64.CPP
        CODE/BBDATA.CPP
        CODE/BDATA.CPP
        CODE/BENCH.CPP
        CODE/BFIOFILE.CPP
        CODE/BIGCHECK.CPP
        CODE/BLOWFISH.CPP
        CODE/BLOWPIPE.CPP
        CODE/BLWSTRAW.CPP
        CODE/BMP8.CPP
        CODE/BUFF.CPP
        CODE/BUILDING.CPP
        CODE/BULLET.CPP
        CODE/CARGO.CPP
        CODE/CARRY.CPP
        CODE/CCDDE.CPP
        CODE/CCFILE.CPP
        CODE/CCINI.CPP
        CODE/CCMPATH.CPP
        CODE/CCPTR.CPP
        CODE/CCTEN.CPP
        CODE/CDATA.CPP
        CODE/CDFILE.CPP
        CODE/CELL.CPP
        CODE/CHECKBOX.CPP
        CODE/CHEKLIST.CPP
        CODE/CLASS.CPP
        CODE/COLRLIST.CPP
        CODE/COMBAT.CPP
        CODE/COMBUF.CPP
        CODE/COMINIT.CPP
        CODE/COMQUEUE.CPP
        CODE/CONFDLG.CPP
        CODE/CONNECT.CPP
        CODE/CONQUER.CPP
        CODE/CONST.CPP
        CODE/CONTROL.CPP
        CODE/COORD.CPP
        CODE/CRATE.CPP
        CODE/CRC.CPP
        CODE/CRCPIPE.CPP
        CODE/CRCSTRAW.CPP
        CODE/CREDITS.CPP
        CODE/CREW.CPP
        CODE/CSTRAW.CPP
        CODE/CWSTUB.C
        CODE/DDE.CPP
        CODE/DEBUG.CPP
        CODE/DESCDLG.CPP
        CODE/DIAL8.CPP
        CODE/DIALOG.CPP
        CODE/DIBFILE.CPP
        CODE/DIBUTIL.CPP
        CODE/DISPLAY.CPP
        CODE/DOOR.CPP
        CODE/DPMI.CPP
        CODE/DRIVE.CPP
        CODE/DROP.CPP
        CODE/DTABLE.CPP
        CODE/DYNAVEC.CPP
        CODE/EDIT.CPP
        CODE/EGOS.CPP
        CODE/ENDING.CPP
        CODE/EVENT.CPP
        CODE/EXPAND.CPP
        CODE/FACE.CPP
        CODE/FACING.CPP
        CODE/FACTORY.CPP
        CODE/FIELD.CPP
        CODE/FILE.CPP
        CODE/FINDPATH.CPP
        CODE/FIXED.CPP
        CODE/FLASHER.CPP
        CODE/FLY.CPP
        CODE/FOOT.CPP
        CODE/FUSE.CPP
        CODE/GADGET.CPP
        CODE/GAMEDLG.CPP
        CODE/GAUGE.CPP
        CODE/GETCPU.CPP
        CODE/GLOBALS.CPP
        CODE/GOPTIONS.CPP
        CODE/GSCREEN.CPP
        CODE/HDATA.CPP
        CODE/HEAP.CPP
        CODE/HELP.CPP
        CODE/HOUSE.CPP
        CODE/HSV.CPP
        CODE/ICONLIST.CPP
        CODE/IDATA.CPP
        CODE/INFANTRY.CPP
        CODE/INI.CPP
        CODE/INIBIN.CPP
        CODE/INICODE.CPP
        CODE/INIT.CPP
        CODE/INT.CPP
        CODE/INTERNET.CPP
        CODE/INTERPAL.CPP
        CODE/INTRO.CPP
        CODE/IOMAP.CPP
        CODE/IOOBJ.CPP
        CODE/IPX.CPP
        CODE/IPX95.CPP
        CODE/IPXADDR.CPP
        CODE/IPXCONN.CPP
        CODE/IPXGCONN.CPP
        CODE/IPXMGR.CPP
        CODE/ITABLE.CPP
        CODE/JSHELL.CPP
        CODE/KEY.CPP
        CODE/KEYBOARD.CPP
        CODE/KEYFRAME.CPP
        CODE/LAYER.CPP
        CODE/LCW.CPP
        CODE/LCWPIPE.CPP
        CODE/LCWSTRAW.CPP
        CODE/LCWUNCMP.CPP
        CODE/LINK.CPP
        CODE/LIST.CPP
        CODE/LOADDLG.CPP
        CODE/LOGIC.CPP
        CODE/LZO1X_C.CPP
        CODE/LZO1X_D.CPP
        CODE/LZOPIPE.CPP
        CODE/LZOSTRAW.CPP
        CODE/LZW.CPP
        CODE/LZWOTRAW.CPP
        CODE/LZWPIPE.CPP
        CODE/LZWSTRAW.CPP
        CODE/MAP.CPP
        CODE/MAPEDDLG.CPP
        CODE/MAPEDIT.CPP
        CODE/MAPEDPLC.CPP
        CODE/MAPEDSEL.CPP
        CODE/MAPEDTM.CPP
        CODE/MAPSEL.CPP
        CODE/MCI.CPP
        CODE/MCIMOVIE.CPP
        CODE/MENUS.CPP
        CODE/MISSION.CPP
        CODE/MIXFILE.CPP
        CODE/MONOC.CPP
        CODE/MOUSE.CPP
        CODE/MP.CPP
        CODE/MPGSET.CPP
        CODE/MPLAYER.CPP
        CODE/MPLIB.CPP
        CODE/MPLPC.CPP
        CODE/MPMGRD.CPP
        CODE/MPMGRW.CPP
        CODE/MPU.CPP
        CODE/MSGBOX.CPP
        CODE/MSGLIST.CPP
        CODE/NETDLG.CPP
        CODE/NOSEQCON.CPP
        CODE/NULLCONN.CPP
        CODE/NULLDLG.CPP
        CODE/NULLMGR.CPP
        CODE/NUMBER.CPP
        CODE/OBJECT.CPP
        CODE/ODATA.CPP
        CODE/OPTIONS.CPP
        CODE/OVERLAY.CPP
        CODE/PACKET.CPP
        CODE/PIPE.CPP
        CODE/PK.CPP
        CODE/PKPIPE.CPP
        CODE/PKSTRAW.CPP
        CODE/POWER.CPP
        CODE/PROFILE.CPP
        CODE/QUEUE.CPP
        CODE/RADAR.CPP
        CODE/RADIO.CPP
        CODE/RAMFILE.CPP
        CODE/RAND.CPP
        CODE/RANDOM.CPP
        CODE/RAWFILE.CPP
        CODE/RAWOLAPI.CPP
        CODE/READLINE.CPP
        CODE/RECT.CPP
        CODE/REINF.CPP
        CODE/RGB.CPP
        CODE/RNDSTRAW.CPP
        CODE/ROTBMP.CPP
        CODE/RULES.CPP
        CODE/SAVELOAD.CPP
        CODE/SCENARIO.CPP
        CODE/SCORE.CPP
        CODE/SCROLL.CPP
        CODE/SDATA.CPP
        CODE/SEDITDLG.CPP
        CODE/SENDFILE.CPP
        CODE/SEQCONN.CPP
        CODE/SESSION.CPP
        CODE/SHA.CPP
        CODE/SHAPEBTN.CPP
        CODE/SHAPIPE.CPP
        CODE/SHASTRAW.CPP
        CODE/SIDEBAR.CPP
        CODE/SLIDER.CPP
        CODE/SMUDGE.CPP
        CODE/SOUNDDLG.CPP
        CODE/SPECIAL.CPP
        CODE/SPRITE.CPP
        CODE/STARTUP.CPP
        CODE/STATBTN.CPP
        CODE/STATS.CPP
        CODE/STRAW.CPP
        CODE/STUB.CPP
        CODE/SUPER.CPP
        CODE/SURFACE.CPP
        CODE/TAB.CPP
        CODE/TACTION.CPP
        CODE/TARCOM.CPP
        CODE/TARGET.CPP
        CODE/TCPIP.CPP
        CODE/TDATA.CPP
        CODE/TEAM.CPP
        CODE/TEAMTYPE.CPP
        CODE/TECHNO.CPP
        CODE/TEMP.CPP
        CODE/TEMPLATE.CPP
        CODE/TENMGR.CPP
        CODE/TERRAIN.CPP
        CODE/TEVENT.CPP
        CODE/TEXTBTN.CPP
        CODE/THEME.CPP
        CODE/TOGGLE.CPP
        CODE/TOOLTIP.CPP
        CODE/TRACKER.CPP
        CODE/TRIGGER.CPP
        CODE/TRIGTYPE.CPP
        CODE/TURRET.CPP
        CODE/TXTLABEL.CPP
        CODE/UDATA.CPP
        CODE/UDPADDR.CPP
        CODE/UNIT.CPP
        CODE/UTRACKER.CPP
        CODE/VDATA.CPP
        CODE/VECTOR.CPP
        CODE/VERSION.CPP
        CODE/VESSEL.CPP
        CODE/VISUDLG.CPP
        CODE/VORTEX.CPP
        CODE/W95TRACE.CPP
        CODE/WARHEAD.CPP
        CODE/WEAPON.CPP
        CODE/WINSTUB.CPP
        CODE/WOLAPIOB.CPP
        CODE/WOLEDIT.CPP
        CODE/WOLSTRNG.CPP
        CODE/WOL_CGAM.CPP
        CODE/WOL_CHAT.CPP
        CODE/WOL_DNLD.CPP
        CODE/WOL_GSUP.CPP
        CODE/WOL_LOGN.CPP
        CODE/WOL_MAIN.CPP
        CODE/WOL_OPT.CPP
        CODE/WRITEPCX.CPP
        CODE/WSPIPX.CPP
        CODE/WSPROTO.CPP
        CODE/WSPUDP.CPP
        CODE/XPIPE.CPP
        CODE/XSTRAW.CPP
        CODE/_WSPROTO.CPP
        LAUNCHER/256BMP.C
        LAUNCHER/BITMAP.CPP
        LAUNCHER/CONFIGFILE.CPP
        LAUNCHER/DIALOG.CPP
        LAUNCHER/FINDPATCH.CPP
        LAUNCHER/LOADBMP.CPP
        LAUNCHER/MAIN.CPP
        LAUNCHER/MONOD.CPP
        LAUNCHER/PATCH.CPP
        LAUNCHER/PROCESS.CPP
        LAUNCHER/STREAMER.CPP
        LAUNCHER/WDEBUG.CPP
        LAUNCHER/WINBLOWS.CPP
        LAUNCHER/WSTRING.CPP
)

set(ASM_SOURCES
CODE/2KEYFBUF.ASM
CODE/2SUPPORT.ASM
CODE/2TXTPRNT.ASM
CODE/COORDA.ASM
CODE/CPUID.ASM
CODE/IPXPROT.ASM
CODE/IPXREAL.ASM
CODE/KEYFBUFF.ASM
CODE/LCWCOMP.ASM
CODE/SUPPORT.ASM
CODE/TXTPRNT.ASM
CODE/WINASM.ASM
LAUNCH/LAUNCH.ASM
)

list(TRANSFORM SOURCES PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/")
list(TRANSFORM ASM_SOURCES PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/")

if(NOT ENABLE_ASM)
    set(ASM_SOURCES)
elseif(REPLACEMENT_ASM_DIR)
    file(GLOB ASM_SOURCES "${REPLACEMENT_ASM_DIR}/*.asm")
endif()
    
foreach(src IN LISTS SOURCES)
    set_source_files_properties(${src} PROPERTIES LANGUAGE C COMPILE_OPTIONS "-x;c")
endforeach()

add_executable(redalert ${SOURCES} ${ASM_SOURCES})
